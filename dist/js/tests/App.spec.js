"use strict";
var Promise = require("bluebird");
var sinon = require("sinon");
var chai_1 = require("chai");
var lazy_dependable_1 = require("lazy-dependable");
var App = require("../index");
var ModuleNames_1 = require("../lib/config/ModuleNames");
var DummyInitializer = (function () {
    function DummyInitializer() {
    }
    DummyInitializer.prototype.initialize = function (app) {
        var defer = Promise.defer();
        defer.resolve(true);
        return defer.promise;
    };
    return DummyInitializer;
}());
var DummyConfigBuilder = (function () {
    function DummyConfigBuilder() {
    }
    DummyConfigBuilder.prototype.configure = function (config) {
        var defer = Promise.defer();
        config["me"] = "harsh raval";
        config.putExtra("ok", "awesome");
        defer.resolve();
        return defer.promise;
    };
    return DummyConfigBuilder;
}());
describe("Application", function () {
    var packageData = require("../../package.json");
    var dummyInit = new DummyInitializer();
    var dummyConfigBuilder = new DummyConfigBuilder();
    var initSpy, configSpy;
    before(function () {
        initSpy = sinon.spy(dummyInit, "initialize");
        configSpy = sinon.spy(dummyConfigBuilder, "configure");
        App.initializer.addInitializer(dummyInit);
        App.configBuilder.addConfigBuilder(dummyConfigBuilder);
    });
    it("shoud be initialized", function () {
        chai_1.expect(App).to.exist;
        chai_1.expect(App.application).to.exist;
        chai_1.expect(App.application).to.be.an("object");
    });
    it("shoud extend Container", function () {
        chai_1.expect(App.application instanceof lazy_dependable_1.Container).to.be.true;
    });
    before(function (done) {
        App.application.serve({}, function () {
            done();
        });
    });
    describe("Configuration", function () {
        it("shoud be initialized", function () {
            chai_1.expect(App.application.config).to.exist;
        });
        it("shoud match package version and name", function () {
            chai_1.expect(App.application.name).to.exist;
            chai_1.expect(App.application.version).to.exist;
            chai_1.expect(App.application.name).to.be.eql(packageData.name);
            chai_1.expect(App.application.version).to.be.eql(packageData.version);
        });
        it("should be in active status", function () {
            chai_1.expect(App.application.active).to.be.true;
        });
        it("should return proper running status", function () {
            chai_1.expect(App.application.active).to.be.true;
            chai_1.expect(App.application.status).to.be.eql({
                active: true,
                name: packageData.name,
                version: packageData.version
            });
        });
        describe("Builder", function () {
            it("should call configure of all config builders", function () {
                chai_1.expect(configSpy.calledOnce).to.be.true;
            });
            it("should have custom config properties added by config builder", function () {
                var config = App.application.config;
                chai_1.expect(config["me"]).to.exist.and.to.eql("harsh raval");
                chai_1.expect(config.getExtra("ok")).to.exist.and.to.eql("awesome");
            });
        });
    });
    describe("Initializers", function () {
        it("should call initialize of all initializers", function () {
            chai_1.expect(initSpy.calledOnce).to.be.true;
        });
    });
    describe("Modules", function () {
        it("should have no unresolved modules", function () {
            chai_1.expect(App.application.modules.unresolved.empty()).to.be.true;
        });
        it("should have all default modules resolved", function () {
            chai_1.expect(App.application.resolved).to.exist;
            chai_1.expect(Object.keys(App.application.resolved)).to.be.an("array").and.to.be.not.empty
                .and.to.be.equal(["database", "passport", "http", "app"]);
        });
        it("should be able to resolve app module", function (done) {
            App.application.resolve(ModuleNames_1.default.EXPRESS_APP_MODULE, function (app) {
                chai_1.expect(app).to.exist;
                chai_1.expect(app.get).to.exist;
                chai_1.expect(app.post).to.exist;
                chai_1.expect(app.put).to.exist;
                chai_1.expect(app.delete).to.exist;
                done();
            });
        });
        it("should be able to resolve database module", function (done) {
            App.application.resolve(ModuleNames_1.default.DATABASE_MODULE, function (database) {
                chai_1.expect(database).to.exist;
                chai_1.expect(database.isConnected()).to.be.true;
                chai_1.expect(database.registerModel).to.exist;
                chai_1.expect(database.isModelExistInModels("dummy")).to.be.false;
                done();
            });
        });
        it("should have empty exportable modules", function () {
            chai_1.expect(App.application.exportableModules).to.be.an("array").and.to.be.empty;
        });
        it("should thorw error for unavailable modules", function () {
            var funcWrapper = function () { new App.Module("users"); };
            chai_1.expect(funcWrapper).to.throw("Not able to find module with name users. Please make sure its loaded.");
        });
    });
});

//# sourceMappingURL=data:application/json;base64,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VyxDQUFDLE9BQU8sQ0FBQyxxQkFBVyxDQUFDLGVBQWUsRUFBRSxVQUFDLFFBQVE7Z0JBQzFELGFBQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDO2dCQUMxQixhQUFNLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUM7Z0JBQzFDLGFBQU0sQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQztnQkFDeEMsYUFBTSxDQUFDLFFBQVEsQ0FBQyxvQkFBb0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDO2dCQUMzRCxJQUFJLEVBQUUsQ0FBQztZQUNYLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsc0NBQXNDLEVBQUU7WUFDdkMsYUFBTSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUM7UUFDaEYsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNENBQTRDLEVBQUU7WUFDN0MsSUFBTSxXQUFXLEdBQUcsY0FBUSxJQUFJLEdBQUcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdkQsYUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsdUVBQXVFLENBQUMsQ0FBQztRQUMxRyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoidGVzdHMvQXBwLnNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBQcm9taXNlIGZyb20gXCJibHVlYmlyZFwiO1xuaW1wb3J0ICogYXMgc2lub24gZnJvbSBcInNpbm9uXCI7XG5pbXBvcnQgKiBhcyBleHByZXNzIGZyb20gXCJleHByZXNzXCI7XG5pbXBvcnQgeyBleHBlY3QgfSBmcm9tIFwiY2hhaVwiO1xuaW1wb3J0IHsgQ29udGFpbmVyIH0gZnJvbSBcImxhenktZGVwZW5kYWJsZVwiO1xuaW1wb3J0ICogYXMgQXBwIGZyb20gXCIuLi9pbmRleFwiO1xuaW1wb3J0IE1vZHVsZU5hbWVzIGZyb20gXCIuLi9saWIvY29uZmlnL01vZHVsZU5hbWVzXCI7XG5cbmNsYXNzIER1bW15SW5pdGlhbGl6ZXIgaW1wbGVtZW50cyBBcHAuSUFwcEluaXRpYWxpemVyIHtcbiAgICBpbml0aWFsaXplKGFwcD86IHR5cGVvZiBBcHAuYXBwbGljYXRpb24pOiBQcm9taXNlPHt9PiB7XG4gICAgICAgIGNvbnN0IGRlZmVyID0gUHJvbWlzZS5kZWZlcigpO1xuICAgICAgICBkZWZlci5yZXNvbHZlKHRydWUpO1xuICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcbiAgICB9XG59XG5cbmNsYXNzIER1bW15Q29uZmlnQnVpbGRlciBpbXBsZW1lbnRzIEFwcC5JQ29uZmlnQnVpbGRlciB7XG4gICAgY29uZmlndXJlKGNvbmZpZzogQXBwLkNvbmZpZ3VyYXRpb24pIHtcbiAgICAgICAgdmFyIGRlZmVyID0gUHJvbWlzZS5kZWZlcigpO1xuICAgICAgICBjb25maWdbXCJtZVwiXSA9IFwiaGFyc2ggcmF2YWxcIjtcbiAgICAgICAgY29uZmlnLnB1dEV4dHJhKFwib2tcIiwgXCJhd2Vzb21lXCIpO1xuICAgICAgICBkZWZlci5yZXNvbHZlKCk7XG4gICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xuICAgIH1cbn1cblxuZGVzY3JpYmUoXCJBcHBsaWNhdGlvblwiLCAoKSA9PiB7XG4gICAgY29uc3QgcGFja2FnZURhdGEgPSByZXF1aXJlKFwiLi4vLi4vcGFja2FnZS5qc29uXCIpO1xuICAgIGNvbnN0IGR1bW15SW5pdCA9IG5ldyBEdW1teUluaXRpYWxpemVyKCk7XG4gICAgY29uc3QgZHVtbXlDb25maWdCdWlsZGVyID0gbmV3IER1bW15Q29uZmlnQnVpbGRlcigpO1xuICAgIGxldCBpbml0U3B5OiBTaW5vbi5TaW5vblNweSwgY29uZmlnU3B5OiBTaW5vbi5TaW5vblNweTtcblxuICAgIGJlZm9yZSgoKSA9PiB7XG4gICAgICAgIGluaXRTcHkgPSBzaW5vbi5zcHkoZHVtbXlJbml0LCBcImluaXRpYWxpemVcIik7XG4gICAgICAgIGNvbmZpZ1NweSA9IHNpbm9uLnNweShkdW1teUNvbmZpZ0J1aWxkZXIsIFwiY29uZmlndXJlXCIpO1xuICAgICAgICBBcHAuaW5pdGlhbGl6ZXIuYWRkSW5pdGlhbGl6ZXIoZHVtbXlJbml0KTtcbiAgICAgICAgQXBwLmNvbmZpZ0J1aWxkZXIuYWRkQ29uZmlnQnVpbGRlcihkdW1teUNvbmZpZ0J1aWxkZXIpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91ZCBiZSBpbml0aWFsaXplZFwiLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdChBcHApLnRvLmV4aXN0O1xuICAgICAgICBleHBlY3QoQXBwLmFwcGxpY2F0aW9uKS50by5leGlzdDtcbiAgICAgICAgZXhwZWN0KEFwcC5hcHBsaWNhdGlvbikudG8uYmUuYW4oXCJvYmplY3RcIik7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VkIGV4dGVuZCBDb250YWluZXJcIiwgKCkgPT4ge1xuICAgICAgICBleHBlY3QoQXBwLmFwcGxpY2F0aW9uIGluc3RhbmNlb2YgQ29udGFpbmVyKS50by5iZS50cnVlO1xuICAgIH0pO1xuXG4gICAgYmVmb3JlKChkb25lKSA9PiB7XG4gICAgICAgIEFwcC5hcHBsaWNhdGlvbi5zZXJ2ZSh7fSwgKCkgPT4ge1xuICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiQ29uZmlndXJhdGlvblwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwic2hvdWQgYmUgaW5pdGlhbGl6ZWRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KEFwcC5hcHBsaWNhdGlvbi5jb25maWcpLnRvLmV4aXN0O1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcInNob3VkIG1hdGNoIHBhY2thZ2UgdmVyc2lvbiBhbmQgbmFtZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoQXBwLmFwcGxpY2F0aW9uLm5hbWUpLnRvLmV4aXN0O1xuICAgICAgICAgICAgZXhwZWN0KEFwcC5hcHBsaWNhdGlvbi52ZXJzaW9uKS50by5leGlzdDtcbiAgICAgICAgICAgIGV4cGVjdChBcHAuYXBwbGljYXRpb24ubmFtZSkudG8uYmUuZXFsKHBhY2thZ2VEYXRhLm5hbWUpO1xuICAgICAgICAgICAgZXhwZWN0KEFwcC5hcHBsaWNhdGlvbi52ZXJzaW9uKS50by5iZS5lcWwocGFja2FnZURhdGEudmVyc2lvbik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwic2hvdWxkIGJlIGluIGFjdGl2ZSBzdGF0dXNcIiwgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KEFwcC5hcHBsaWNhdGlvbi5hY3RpdmUpLnRvLmJlLnRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwic2hvdWxkIHJldHVybiBwcm9wZXIgcnVubmluZyBzdGF0dXNcIiwgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KEFwcC5hcHBsaWNhdGlvbi5hY3RpdmUpLnRvLmJlLnRydWU7XG4gICAgICAgICAgICBleHBlY3QoQXBwLmFwcGxpY2F0aW9uLnN0YXR1cykudG8uYmUuZXFsKHtcbiAgICAgICAgICAgICAgICBhY3RpdmU6IHRydWUsXG4gICAgICAgICAgICAgICAgbmFtZTogcGFja2FnZURhdGEubmFtZSxcbiAgICAgICAgICAgICAgICB2ZXJzaW9uOiBwYWNrYWdlRGF0YS52ZXJzaW9uXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoXCJCdWlsZGVyXCIsICgpID0+IHtcbiAgICAgICAgICAgIGl0KFwic2hvdWxkIGNhbGwgY29uZmlndXJlIG9mIGFsbCBjb25maWcgYnVpbGRlcnNcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGV4cGVjdChjb25maWdTcHkuY2FsbGVkT25jZSkudG8uYmUudHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdChcInNob3VsZCBoYXZlIGN1c3RvbSBjb25maWcgcHJvcGVydGllcyBhZGRlZCBieSBjb25maWcgYnVpbGRlclwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29uZmlnID0gQXBwLmFwcGxpY2F0aW9uLmNvbmZpZztcbiAgICAgICAgICAgICAgICBleHBlY3QoY29uZmlnW1wibWVcIl0pLnRvLmV4aXN0LmFuZC50by5lcWwoXCJoYXJzaCByYXZhbFwiKTtcbiAgICAgICAgICAgICAgICBleHBlY3QoY29uZmlnLmdldEV4dHJhKFwib2tcIikpLnRvLmV4aXN0LmFuZC50by5lcWwoXCJhd2Vzb21lXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJJbml0aWFsaXplcnNcIiwgKCkgPT4ge1xuICAgICAgICBpdChcInNob3VsZCBjYWxsIGluaXRpYWxpemUgb2YgYWxsIGluaXRpYWxpemVyc1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoaW5pdFNweS5jYWxsZWRPbmNlKS50by5iZS50cnVlO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiTW9kdWxlc1wiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwic2hvdWxkIGhhdmUgbm8gdW5yZXNvbHZlZCBtb2R1bGVzXCIsICgpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChBcHAuYXBwbGljYXRpb24ubW9kdWxlcy51bnJlc29sdmVkLmVtcHR5KCkpLnRvLmJlLnRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwic2hvdWxkIGhhdmUgYWxsIGRlZmF1bHQgbW9kdWxlcyByZXNvbHZlZFwiLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoQXBwLmFwcGxpY2F0aW9uLnJlc29sdmVkKS50by5leGlzdDtcbiAgICAgICAgICAgIGV4cGVjdChPYmplY3Qua2V5cyhBcHAuYXBwbGljYXRpb24ucmVzb2x2ZWQpKS50by5iZS5hbihcImFycmF5XCIpLmFuZC50by5iZS5ub3QuZW1wdHlcbiAgICAgICAgICAgICAgICAuYW5kLnRvLmJlLmVxdWFsKFsgXCJkYXRhYmFzZVwiLCBcInBhc3Nwb3J0XCIsIFwiaHR0cFwiLCBcImFwcFwiIF0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcInNob3VsZCBiZSBhYmxlIHRvIHJlc29sdmUgYXBwIG1vZHVsZVwiLCAoZG9uZSkgPT4ge1xuICAgICAgICAgICAgQXBwLmFwcGxpY2F0aW9uLnJlc29sdmUoTW9kdWxlTmFtZXMuRVhQUkVTU19BUFBfTU9EVUxFLCAoYXBwKSA9PiB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGFwcCkudG8uZXhpc3Q7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGFwcC5nZXQpLnRvLmV4aXN0O1xuICAgICAgICAgICAgICAgIGV4cGVjdChhcHAucG9zdCkudG8uZXhpc3Q7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGFwcC5wdXQpLnRvLmV4aXN0O1xuICAgICAgICAgICAgICAgIGV4cGVjdChhcHAuZGVsZXRlKS50by5leGlzdDtcbiAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJzaG91bGQgYmUgYWJsZSB0byByZXNvbHZlIGRhdGFiYXNlIG1vZHVsZVwiLCAoZG9uZSkgPT4ge1xuICAgICAgICAgICAgQXBwLmFwcGxpY2F0aW9uLnJlc29sdmUoTW9kdWxlTmFtZXMuREFUQUJBU0VfTU9EVUxFLCAoZGF0YWJhc2UpID0+IHtcbiAgICAgICAgICAgICAgICBleHBlY3QoZGF0YWJhc2UpLnRvLmV4aXN0O1xuICAgICAgICAgICAgICAgIGV4cGVjdChkYXRhYmFzZS5pc0Nvbm5lY3RlZCgpKS50by5iZS50cnVlO1xuICAgICAgICAgICAgICAgIGV4cGVjdChkYXRhYmFzZS5yZWdpc3Rlck1vZGVsKS50by5leGlzdDtcbiAgICAgICAgICAgICAgICBleHBlY3QoZGF0YWJhc2UuaXNNb2RlbEV4aXN0SW5Nb2RlbHMoXCJkdW1teVwiKSkudG8uYmUuZmFsc2U7XG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwic2hvdWxkIGhhdmUgZW1wdHkgZXhwb3J0YWJsZSBtb2R1bGVzXCIsICgpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChBcHAuYXBwbGljYXRpb24uZXhwb3J0YWJsZU1vZHVsZXMpLnRvLmJlLmFuKFwiYXJyYXlcIikuYW5kLnRvLmJlLmVtcHR5O1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcInNob3VsZCB0aG9ydyBlcnJvciBmb3IgdW5hdmFpbGFibGUgbW9kdWxlc1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBmdW5jV3JhcHBlciA9ICgpID0+IHsgbmV3IEFwcC5Nb2R1bGUoXCJ1c2Vyc1wiKTsgfTtcbiAgICAgICAgICAgIGV4cGVjdChmdW5jV3JhcHBlcikudG8udGhyb3coXCJOb3QgYWJsZSB0byBmaW5kIG1vZHVsZSB3aXRoIG5hbWUgdXNlcnMuIFBsZWFzZSBtYWtlIHN1cmUgaXRzIGxvYWRlZC5cIik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
