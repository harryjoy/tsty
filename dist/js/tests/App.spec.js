"use strict";
var sinon = require("sinon");
var chai_1 = require("chai");
var lazy_dependable_1 = require("lazy-dependable");
var App = require("../index");
var TestInitializer_1 = require("./mocks/TestInitializer");
var TestConfigBuilder_1 = require("./mocks/TestConfigBuilder");
var TestDB_1 = require("./mocks/TestDB");
describe("Application", function () {
    var PACKAGE_DATA = require("../../package.json");
    var DEFAULT_MODULES = ["database", "passport", "http", "app"];
    var dummyInit = new TestInitializer_1.default();
    var dummyConfigBuilder = new TestConfigBuilder_1.default();
    var initSpy, configSpy;
    before(function () {
        initSpy = sinon.spy(dummyInit, "initialize");
        configSpy = sinon.spy(dummyConfigBuilder, "configure");
        App.initializer.addInitializer(dummyInit);
        App.DatabaseFactory.registerDbEngine("test", TestDB_1.default);
        App.configBuilder.addConfigBuilder(dummyConfigBuilder);
    });
    it("shoud be initialized", function () {
        chai_1.expect(App).to.exist;
        chai_1.expect(App.application).to.exist;
        chai_1.expect(App.application).to.be.an("object");
    });
    it("shoud extend Container", function () {
        chai_1.expect(App.application instanceof lazy_dependable_1.Container).to.be.true;
    });
    before(function (done) {
        App.application.serve({}, function () {
            done();
        });
    });
    describe("Configuration", function () {
        it("shoud be initialized", function () {
            chai_1.expect(App.application.config).to.exist;
        });
        it("shoud match package version and name", function () {
            chai_1.expect(App.application.name).to.exist;
            chai_1.expect(App.application.version).to.exist;
            chai_1.expect(App.application.name).to.be.eql(PACKAGE_DATA.name);
            chai_1.expect(App.application.version).to.be.eql(PACKAGE_DATA.version);
        });
        it("should be in active status", function () {
            chai_1.expect(App.application.active).to.be.true;
        });
        it("should return proper running status", function () {
            chai_1.expect(App.application.active).to.be.true;
            chai_1.expect(App.application.status).to.be.eql({
                active: true,
                name: PACKAGE_DATA.name,
                version: PACKAGE_DATA.version
            });
        });
        describe("Builder", function () {
            it("should call configure of all config builders", function () {
                chai_1.expect(configSpy.calledOnce).to.be.true;
            });
            it("should have custom config properties added by config builder", function () {
                var config = App.application.config;
                chai_1.expect(config.db).to.exist.and.to.eql("test");
                chai_1.expect(config["me"]).to.exist.and.to.eql("harsh raval");
                chai_1.expect(config.getExtra("ok")).to.exist.and.to.eql("awesome");
            });
        });
    });
    describe("Initializers", function () {
        it("should call initialize of all initializers", function () {
            chai_1.expect(initSpy.calledOnce).to.be.true;
        });
    });
});

//# sourceMappingURL=data:application/json;base64,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QUMsQ0FBQztnQkFDOUMsYUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUM7Z0JBQ3hELGFBQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNqRSxDQUFDLENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsY0FBYyxFQUFFO1FBQ3JCLEVBQUUsQ0FBQyw0Q0FBNEMsRUFBRTtZQUM3QyxhQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDO1FBQzFDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0cy9BcHAuc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFByb21pc2UgZnJvbSBcImJsdWViaXJkXCI7XG5pbXBvcnQgKiBhcyBzaW5vbiBmcm9tIFwic2lub25cIjtcbmltcG9ydCAqIGFzIGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIjtcbmltcG9ydCAqIGFzIHJlcXVlc3QgZnJvbSBcInN1cGVydGVzdFwiO1xuaW1wb3J0IHsgZXhwZWN0IH0gZnJvbSBcImNoYWlcIjtcbmltcG9ydCB7IENvbnRhaW5lciB9IGZyb20gXCJsYXp5LWRlcGVuZGFibGVcIjtcbmltcG9ydCAqIGFzIEFwcCBmcm9tIFwiLi4vaW5kZXhcIjtcbmltcG9ydCBNb2R1bGVOYW1lcyBmcm9tIFwiLi4vbGliL2NvbmZpZy9Nb2R1bGVOYW1lc1wiO1xuaW1wb3J0IFRlc3RJbml0aWFsaXplciBmcm9tIFwiLi9tb2Nrcy9UZXN0SW5pdGlhbGl6ZXJcIjtcbmltcG9ydCBUZXN0Q29uZmlnQnVpbGRlciBmcm9tIFwiLi9tb2Nrcy9UZXN0Q29uZmlnQnVpbGRlclwiO1xuaW1wb3J0IFRlc3REQiBmcm9tIFwiLi9tb2Nrcy9UZXN0REJcIjtcblxuZGVzY3JpYmUoXCJBcHBsaWNhdGlvblwiLCAoKSA9PiB7XG4gICAgY29uc3QgUEFDS0FHRV9EQVRBID0gcmVxdWlyZShcIi4uLy4uL3BhY2thZ2UuanNvblwiKTtcbiAgICBjb25zdCBERUZBVUxUX01PRFVMRVMgPSBbIFwiZGF0YWJhc2VcIiwgXCJwYXNzcG9ydFwiLCBcImh0dHBcIiwgXCJhcHBcIiBdO1xuICAgIGNvbnN0IGR1bW15SW5pdCA9IG5ldyBUZXN0SW5pdGlhbGl6ZXIoKTtcbiAgICBjb25zdCBkdW1teUNvbmZpZ0J1aWxkZXIgPSBuZXcgVGVzdENvbmZpZ0J1aWxkZXIoKTtcbiAgICBsZXQgaW5pdFNweTogU2lub24uU2lub25TcHksIGNvbmZpZ1NweTogU2lub24uU2lub25TcHk7XG5cbiAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgICBpbml0U3B5ID0gc2lub24uc3B5KGR1bW15SW5pdCwgXCJpbml0aWFsaXplXCIpO1xuICAgICAgICBjb25maWdTcHkgPSBzaW5vbi5zcHkoZHVtbXlDb25maWdCdWlsZGVyLCBcImNvbmZpZ3VyZVwiKTtcbiAgICAgICAgQXBwLmluaXRpYWxpemVyLmFkZEluaXRpYWxpemVyKGR1bW15SW5pdCk7XG4gICAgICAgIEFwcC5EYXRhYmFzZUZhY3RvcnkucmVnaXN0ZXJEYkVuZ2luZShcInRlc3RcIiwgVGVzdERCKTtcbiAgICAgICAgQXBwLmNvbmZpZ0J1aWxkZXIuYWRkQ29uZmlnQnVpbGRlcihkdW1teUNvbmZpZ0J1aWxkZXIpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91ZCBiZSBpbml0aWFsaXplZFwiLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdChBcHApLnRvLmV4aXN0O1xuICAgICAgICBleHBlY3QoQXBwLmFwcGxpY2F0aW9uKS50by5leGlzdDtcbiAgICAgICAgZXhwZWN0KEFwcC5hcHBsaWNhdGlvbikudG8uYmUuYW4oXCJvYmplY3RcIik7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VkIGV4dGVuZCBDb250YWluZXJcIiwgKCkgPT4ge1xuICAgICAgICBleHBlY3QoQXBwLmFwcGxpY2F0aW9uIGluc3RhbmNlb2YgQ29udGFpbmVyKS50by5iZS50cnVlO1xuICAgIH0pO1xuXG4gICAgYmVmb3JlKChkb25lKSA9PiB7XG4gICAgICAgIEFwcC5hcHBsaWNhdGlvbi5zZXJ2ZSh7fSwgKCkgPT4ge1xuICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiQ29uZmlndXJhdGlvblwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwic2hvdWQgYmUgaW5pdGlhbGl6ZWRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KEFwcC5hcHBsaWNhdGlvbi5jb25maWcpLnRvLmV4aXN0O1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcInNob3VkIG1hdGNoIHBhY2thZ2UgdmVyc2lvbiBhbmQgbmFtZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoQXBwLmFwcGxpY2F0aW9uLm5hbWUpLnRvLmV4aXN0O1xuICAgICAgICAgICAgZXhwZWN0KEFwcC5hcHBsaWNhdGlvbi52ZXJzaW9uKS50by5leGlzdDtcbiAgICAgICAgICAgIGV4cGVjdChBcHAuYXBwbGljYXRpb24ubmFtZSkudG8uYmUuZXFsKFBBQ0tBR0VfREFUQS5uYW1lKTtcbiAgICAgICAgICAgIGV4cGVjdChBcHAuYXBwbGljYXRpb24udmVyc2lvbikudG8uYmUuZXFsKFBBQ0tBR0VfREFUQS52ZXJzaW9uKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJzaG91bGQgYmUgaW4gYWN0aXZlIHN0YXR1c1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoQXBwLmFwcGxpY2F0aW9uLmFjdGl2ZSkudG8uYmUudHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJzaG91bGQgcmV0dXJuIHByb3BlciBydW5uaW5nIHN0YXR1c1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoQXBwLmFwcGxpY2F0aW9uLmFjdGl2ZSkudG8uYmUudHJ1ZTtcbiAgICAgICAgICAgIGV4cGVjdChBcHAuYXBwbGljYXRpb24uc3RhdHVzKS50by5iZS5lcWwoe1xuICAgICAgICAgICAgICAgIGFjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBuYW1lOiBQQUNLQUdFX0RBVEEubmFtZSxcbiAgICAgICAgICAgICAgICB2ZXJzaW9uOiBQQUNLQUdFX0RBVEEudmVyc2lvblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRlc2NyaWJlKFwiQnVpbGRlclwiLCAoKSA9PiB7XG4gICAgICAgICAgICBpdChcInNob3VsZCBjYWxsIGNvbmZpZ3VyZSBvZiBhbGwgY29uZmlnIGJ1aWxkZXJzXCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICBleHBlY3QoY29uZmlnU3B5LmNhbGxlZE9uY2UpLnRvLmJlLnRydWU7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoXCJzaG91bGQgaGF2ZSBjdXN0b20gY29uZmlnIHByb3BlcnRpZXMgYWRkZWQgYnkgY29uZmlnIGJ1aWxkZXJcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IEFwcC5hcHBsaWNhdGlvbi5jb25maWc7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGNvbmZpZy5kYikudG8uZXhpc3QuYW5kLnRvLmVxbChcInRlc3RcIik7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGNvbmZpZ1tcIm1lXCJdKS50by5leGlzdC5hbmQudG8uZXFsKFwiaGFyc2ggcmF2YWxcIik7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGNvbmZpZy5nZXRFeHRyYShcIm9rXCIpKS50by5leGlzdC5hbmQudG8uZXFsKFwiYXdlc29tZVwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiSW5pdGlhbGl6ZXJzXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJzaG91bGQgY2FsbCBpbml0aWFsaXplIG9mIGFsbCBpbml0aWFsaXplcnNcIiwgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGluaXRTcHkuY2FsbGVkT25jZSkudG8uYmUudHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
